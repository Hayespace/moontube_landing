<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mint Tokens</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.0/ethers.umd.min.js"></script>
    <script src="https://unpkg.com/@walletconnect/web3-provider@1.7.8/dist/umd/index.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #f0f0f0;
        margin: 0;
      }
      .container {
        text-align: center;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      input {
        padding: 8px;
        margin: 8px 0;
        font-size: 16px;
        width: 100%;
        box-sizing: border-box;
      }
      button {
        padding: 10px;
        font-size: 16px;
        cursor: pointer;
        width: 100%;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 4px;
      }
      button:hover {
        background-color: #0056b3;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Mint Tokens</h1>
      <input type="number" id="amount" placeholder="Enter number of tokens" min="1" required />
      <button onclick="handleMint()">Mint Tokens</button>
    </div>

    <script type="module">
      import { ethers } from 'https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.0/ethers.esm.min.js';

      const contractAddress = '0xa66c5d3e81acb18fb29e312f8da4029cab3c0ee7';
      const contractABI = [
        {
          inputs: [
            { internalType: 'address', name: '_to', type: 'address' },
            { internalType: 'uint256', name: '_amount', type: 'uint256' }
          ],
          name: 'mintToMultiple',
          outputs: [],
          stateMutability: 'payable',
          type: 'function'
        },
        {
          inputs: [
            { internalType: 'uint256', name: '_count', type: 'uint256' }
          ],
          name: 'getPrice',
          outputs: [
            { internalType: 'uint256', name: '', type: 'uint256' }
          ],
          stateMutability: 'view',
          type: 'function'
        }
      ];

      async function setupWalletProvider() {
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

        try {
          if (typeof window.ethereum !== 'undefined') {
            // Use MetaMask if available
            await window.ethereum.request({ method: 'eth_requestAccounts' });
            return new ethers.providers.Web3Provider(window.ethereum);
          } else {
            // Use WalletConnect for mobile
            const walletConnectProvider = new WalletConnectProvider.default({
              rpc: {
                1: "https://mainnet.infura.io/v3/361e4e5047824e21b258410f274b3550" // Use your Infura Project ID
              },
              qrcode: !isMobile // Disable QR code on mobile devices
            });

            await walletConnectProvider.enable();
            return new ethers.providers.Web3Provider(walletConnectProvider);
          }
        } catch (error) {
          alert('Error setting up wallet provider: ' + error.message);
          throw error;
        }
      }

      async function mintTokens(toAddress, amount) {
        try {
          const provider = await setupWalletProvider();
          const signer = provider.getSigner();
          const contract = new ethers.Contract(contractAddress, contractABI, signer);
          const price = await contract.getPrice(amount);

          const tx = await contract.mintToMultiple(toAddress, amount, {
            value: ethers.BigNumber.from(price).toString()
          });

          const receipt = await tx.wait();
          alert('Transaction successful!');
          console.log('Transaction receipt:', receipt);
        } catch (error) {
          alert('Minting error: ' + error.message);
          console.error('Error minting tokens:', error);
        }
      }

      window.handleMint = async function () {
        console.log('Mint button clicked'); // Debugging line
        const amount = document.getElementById('amount').value;
        if (!amount || isNaN(amount) || amount <= 0) {
          alert('Please enter a valid token amount.');
          return;
        }

        const recipientAddress = '0x342624F2279EAf3b78901c6E81EcffCb44C153Ab'; // Replace with recipient's address
        const tokenAmount = ethers.BigNumber.from(amount);

        await mintTokens(recipientAddress, tokenAmount);
      };
    </script>
  </body>
</html>
